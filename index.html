<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axis Mundi | Omar Kareim</title>
    <!-- Force refresh cache -->
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        html {scroll-behavior: smooth;}
        body{font-family:'Georgia',serif;background:#0a0a0a;color:#f5f5f5;overflow-x:hidden}
        .landing{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;background:linear-gradient(135deg,#1a1a1a 0%,#0a0a0a 100%);position:relative;overflow:hidden}
        .landing::before{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle,rgba(218,165,32,0.1)0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse 4s ease-in-out infinite}
        @keyframes pulse{0%,100%{transform:translate(-50%,-50%)scale(1);opacity:.3}50%{transform:translate(-50%,-50%)scale(1.2);opacity:.5}}
        h1{font-size:4rem;font-weight:300;letter-spacing:.3rem;margin-bottom:1rem;background:linear-gradient(135deg,#daa520,#f4e4c1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:fadeInUp 1s ease-out}
        .subtitle{font-size:1.5rem;letter-spacing:.5rem;color:#daa520;margin-bottom:3rem;font-weight:300;animation:fadeInUp 1s ease-out .3s both;text-align:center}
        @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
        .scroll-indicator{position:absolute;bottom:40px;font-size:.9rem;color:#daa520;letter-spacing:.2rem;opacity:0.7;animation:bounce 2s infinite}
        @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
        .gallery-section{min-height:100vh;padding:100px 5%;background:#0a0a0a}
        .section-title{text-align:center;font-size:2.5rem;margin-bottom:60px;color:#daa520;letter-spacing:.3rem;font-weight:300}
        .gallery-wrapper{overflow-x:auto;scroll-behavior:smooth;scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;padding-bottom:20px;cursor:grab;position:relative}
        .gallery-wrapper.grabbing{cursor:grabbing}
        .gallery-wrapper::-webkit-scrollbar{display:none}
        .gallery-grid{display:flex;gap:30px}
        .gallery-item{flex:0 0 350px;position:relative;overflow:hidden;border-radius:8px;cursor:pointer;transition:transform .3s,box-shadow .3s;background:#1a1a1a;opacity:0;animation:fadeInGallery 0.8s ease forwards}
        @keyframes fadeInGallery{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
        .gallery-item:hover{transform:translateY(-10px);box-shadow:0 20px 40px rgba(218,165,32,.3)}
        .gallery-item img{width:100%;height:400px;object-fit:cover;display:block;transition:transform .5s}
        .gallery-item:hover img{transform:scale(1.05)}
        .gallery-details{padding:15px;text-align:left}
        .gallery-details h3{font-size:1.2rem;color:#daa520;margin-bottom:5px;font-weight:500;line-height:1.3}
        .gallery-details p{font-size:.9rem;color:#ccc;margin-bottom:3px}
        .auto-scroll-left,.auto-scroll-right{position:absolute;top:50%;transform:translateY(-50%);width:60px;height:60px;background:rgba(218,165,32,.2);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#daa520;font-size:1.8rem;cursor:pointer;z-index:10;opacity:0;transition:opacity .3s;pointer-events:none}
        .auto-scroll-left.show,.auto-scroll-right.show{opacity:1;pointer-events:auto}
        .auto-scroll-left{left:20px}.auto-scroll-right{right:20px}
        .auto-scroll-left::before{content:'<'} .auto-scroll-right::before{content:'>'}
        .vr-section{padding:100px 5%;text-align:center;background:linear-gradient(180deg,#0a0a0a 0%,#1a1a1a 100%)}
        .vr-button{display:inline-block;padding:20px 50px;font-size:1.2rem;letter-spacing:.2rem;color:#0a0a0a;background:linear-gradient(135deg,#daa520,#f4e4c1);border:none;border-radius:50px;cursor:pointer;transition:all .3s;font-family:'Georgia',serif;box-shadow:0 10px 30px rgba(218,165,32,.3)}
        .vr-button:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 15px 40px rgba(218,165,32,.5)}
        .lightbox{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:3000;justify-content:center;align-items:center;overflow-y:auto}
        .lightbox.active{display:flex}
        .lightbox-content{display:flex;max-width:90%;max-height:90vh;gap:40px;align-items:flex-start;pointer-events:none;flex-wrap:wrap}
        .lightbox-content *{pointer-events:auto}
        .lightbox img{max-width:70%;max-height:90vh;object-fit:contain;border-radius:8px}
        .lightbox-details{max-width:30%;color:#f5f5f5;padding-top:20px}
        .lightbox-details h3{font-size:2rem;color:#daa520;margin-bottom:15px;font-weight:500}
        .lightbox-details p{font-size:1.1rem;line-height:1.6;margin-bottom:10px}
        .lightbox-close{position:absolute;top:20px;right:20px;font-size:2rem;color:#daa520;cursor:pointer;width:44px;height:44px;display:flex;align-items:center;justify-content:center;background:rgba(26,26,26,.7);border-radius:50%;transition:transform .3s,background .3s;z-index:3001}
        .lightbox-close:hover{background:#daa520;color:#0a0a0a;transform:scale(1.1)}
        .vr-gallery{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:2000;background:#000}
        .vr-gallery.active{display:block;cursor:none}
        .vr-exit{position:fixed;top:20px;left:20px;padding:15px 30px;background:rgba(218,165,32,.9);color:#0a0a0a;border:none;border-radius:30px;cursor:pointer;z-index:2001;font-size:1rem;letter-spacing:.1rem;transition:all .3s}
        .vr-exit:hover{background:#daa520;transform:scale(1.05)}
        .zoom-controls{position:fixed;top:20px;right:20px;display:flex;gap:10px;z-index:2001}
        .zoom-button{padding:12px 20px;background:rgba(218,165,32,.9);color:#0a0a0a;border:none;border-radius:30px;cursor:pointer;font-size:1rem;letter-spacing:.1rem;transition:all .3s}
        .zoom-button:hover{background:#daa520;transform:scale(1.05)}
        .controls-info{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(26,26,26,.8);color:#daa520;padding:8px 16px;border-radius:20px;font-size:.9rem;opacity:0;transition:opacity .3s;z-index:2001}
        .controls-info.show{opacity:1}
        #muteToggle{position:fixed;bottom:20px;right:20px;z-index:10000;background:rgba(218,165,32,.8);color:#0a0a0a;border:none;border-radius:50%;width:50px;height:50px;cursor:pointer;font-size:1.1rem;line-height:1;font-family:Georgia,serif;transition:transform .2s}
        #muteToggle:hover{transform:scale(1.1)}

        /* MOBILE OPTIMIZATIONS */
        @media (max-width: 768px) {
            h1 {font-size:2.5rem; letter-spacing:.2rem;}
            .subtitle {font-size:1rem; letter-spacing:.3rem;}
            .section-title {font-size:1.8rem;}
            .gallery-item {flex:0 0 280px;}
            .gallery-item img {height:320px;}
            .gallery-details h3 {font-size:1rem;}
            .gallery-details p {font-size:0.8rem;}
            .lightbox-content {flex-direction:column; gap:20px;}
            .lightbox img {max-width:100%; max-height:60vh;}
            .lightbox-details {max-width:100%; padding:10px;}
            .lightbox-details h3 {font-size:1.5rem;}
            .lightbox-details p {font-size:0.9rem;}
            .vr-button {padding:16px 40px; font-size:1rem;}
            .auto-scroll-left, .auto-scroll-right {width:50px; height:50px; font-size:1.5rem;}
        }
        @media (max-width: 480px) {
            h1 {font-size:2rem;}
            .subtitle {font-size:0.9rem;}
            .gallery-item {flex:0 0 240px;}
            .gallery-item img {height:280px;}
        }
    </style>
</head>
<body>

<!-- LANDING -->
<section class="landing">
    <h1>OMAR KAREIM</h1>
    <p class="subtitle">AXIS MUNDI</p>
    <div class="scroll-indicator">SCROLL</div>
</section>

<!-- 2D GALLERY -->
<section class="gallery-section">
    <h2 class="section-title">GALLERY</h2>
    <div class="gallery-wrapper">
        <div class="gallery-grid" id="galleryGrid"></div>
        <div class="auto-scroll-left"><</div>
        <div class="auto-scroll-right">></div>
    </div>
</section>

<!-- VR SECTION -->
<section class="vr-section">
    <button class="vr-button" id="enterVR">ENTER VIRTUAL GALLERY</button>
</section>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox">
    <div class="lightbox-content">
        <img id="lightboxImg" src="" alt="">
        <div class="lightbox-details">
            <h3 id="lightboxTitle"></h3>
            <p id="lightboxMedium"></p>
            <p id="lightboxDate"></p>
            <p id="lightboxDesc"></p>
        </div>
    </div>
    <div class="lightbox-close">×</div>
</div>

<!-- VR GALLERY -->
<div class="vr-gallery" id="vrGallery">
    <button class="vr-exit" id="exitVR">EXIT</button>
    <div class="zoom-controls">
        <button class="zoom-button" id="zoomIn">ZOOM +</button>
        <button class="zoom-button" id="zoomOut">ZOOM −</button>
        <button class="zoom-button" id="resetZoom">RESET</button>
    </div>
    <div class="controls-info" id="controlsInfo">WASD to move • Click to view • Scroll to zoom</div>
    <canvas id="vrCanvas"></canvas>
</div>

<!-- ETHEREAL BACKGROUND SOUND -->
<audio id="bgAudio" loop preload="auto">
    <source src="images/ethereal-bg.mp3" type="audio/mpeg">
</audio>
<button id="muteToggle" title="Toggle background music">Play</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
const artworkData = [
    {file:'images/artwork1.webp',fallback:'images/artwork1.png',title:'Axis Mundi: Codex of Connectedness',medium:'Acrylic on Canvas',date:'2025',description:'A sweeping exploration of human interconnectedness, belief, and belonging, this monumental work unifies diverse spiritual and cultural iconographies within a cosmological framework. Elements of earth, wind, fire, and water serve as anchoring forces, binding the narrative across traditions. At its center stands your interpretation of the Shroud of Turin, framed by symbols that span Abrahamic faiths, ancient mythologies, and contemporary metaphysics. The figure on the far right—your "Goddess of the Information Age"—introduces a striking tension between the ancient and the digital, suggesting a future in which wisdom, technology, and spirituality converge. The result is a visual codex: a map of humanity\'s shared search for meaning.'},
    {file:'images/artwork2.webp',fallback:'images/artwork2.png',title:'Axis Mundi',medium:'Acrylic on Canvas',date:'2025',description:''},
    {file:'images/artwork3.webp',fallback:'images/artwork3.png',title:'El Dorado',medium:'Acrylic on Canvas',date:'2025',description:''},
    {file:'images/artwork4.webp',fallback:'images/artwork4.png',title:'El Dorado',medium:'Acrylic on Canvas',date:'2023',description:'A dynamic fusion of classical form and contemporary iconography, this portrait reimagines Lionel Messi through a Greco-Roman lens—elevating an athlete into the realm of myth. Sculptural gold leaf accentuates his profile, evoking both heroic statuary and regal ornamentation, while roses intertwine as symbols of honor, admiration, and legacy. Set against an expressive modern background, the piece functions as a visual homage to the idea of "giving them their flowers"—celebrating greatness not as spectacle, but as a timeless human pursuit.'},
    {file:'images/artwork5.webp',fallback:'images/artwork5.png',title:'Mjolnir: Forge of Resilience',medium:'Acrylic on Canvas',date:'2023',description:'Echoing the mythical hammer of Thor, this intricate work embodies resilience, sovereignty, and the raw force of creation. The form of Mjolnir emerges through a labyrinth of linework—part sigil, part circuitry—suggesting the convergence of ancient power and modern symbolic languages. Its unexpected uterine silhouette introduces a compelling duality: destruction and creation, war and fertility, chaos and regeneration. This tension reframes the hammer not merely as a weapon of the gods, but as a vessel for rebirth through struggle.'},
    {file:'images/artwork6.webp',fallback:'images/artwork6.png',title:'Threshold',medium:'Acrylic on Canvas',date:'2012',description:'An evocative abstract meditation on transition and possibility, Threshold captures the moment just before emergence—when the familiar dissolves and the unknown begins to take shape. The central circular form, both portal and boundary, both portal and boundary, anchors the composition as sweeping lines and fragmented geometric marks swirl around it like remnants of past structures. Gold fields meet deep shadow, suggesting the meeting point between illumination and obscurity, intention and uncertainty. This work embodies the quiet power of liminality: the space where identity, direction, and meaning are actively formed.'},
    {file:'images/artwork7.webp',fallback:'images/artwork7.png',title:'Threshold',medium:'Acrylic on Canvas',date:'2012',description:''}
];

/* ===== GALLERY BUILDER ===== */
const grid = document.getElementById('galleryGrid');
artworkData.forEach((art, i) => {
    const item = document.createElement('div');
    item.className = 'gallery-item';
    item.style.animationDelay = `${i * 0.1}s`;
    item.onclick = () => openLightbox(i);

    const img = document.createElement('img');
    img.src = art.file;
    img.alt = art.title;
    img.onerror = () => img.src = art.fallback;

    const details = document.createElement('div');
    details.className = 'gallery-details';
    details.innerHTML = `<h3>${art.title}</h3><p>${art.medium} • ${art.date}</p>`;

    item.appendChild(img);
    item.appendChild(details);
    grid.appendChild(item);
});

/* ===== LIGHTBOX ===== */
const lightbox = document.getElementById('lightbox');
const lbImg = document.getElementById('lightboxImg');
const lbTitle = document.getElementById('lightboxTitle');
const lbMedium = document.getElementById('lightboxMedium');
const lbDate = document.getElementById('lightboxDate');
const lbDesc = document.getElementById('lightboxDesc');
const closeBtn = document.querySelector('.lightbox-close');

function openLightbox(idx) {
    const art = artworkData[idx];
    lbImg.src = art.file;
    lbImg.onerror = () => lbImg.src = art.fallback;
    lbTitle.textContent = art.title;
    lbMedium.textContent = art.medium;
    lbDate.textContent = art.date;
    lbDesc.textContent = art.description || '';
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
}
closeBtn.onclick = () => {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
};
lightbox.onclick = e => { 
    if (e.target === lightbox) {
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
    }
};

/* ===== AUTO-SCROLL ARROWS ===== */
const wrapper = document.querySelector('.gallery-wrapper');
const leftArrow = document.querySelector('.auto-scroll-left');
const rightArrow = document.querySelector('.auto-scroll-right');

wrapper.addEventListener('scroll', () => {
    leftArrow.classList.toggle('show', wrapper.scrollLeft > 50);
    rightArrow.classList.toggle('show', wrapper.scrollLeft < wrapper.scrollWidth - wrapper.clientWidth - 50);
});
leftArrow.onclick = () => wrapper.scrollBy({left: -400, behavior: 'smooth'});
rightArrow.onclick = () => wrapper.scrollBy({left: 400, behavior: 'smooth'});

/* ===== VR GALLERY (THREE.JS) ===== */
const vrBtn = document.getElementById('enterVR');
const vrGallery = document.getElementById('vrGallery');
const exitBtn = document.getElementById('exitVR');
const canvas = document.getElementById('vrCanvas');

let scene, camera, renderer, clock;
let moveF = moveB = moveL = moveR = false;
let vel = new THREE.Vector3();
let dir = new THREE.Vector3();
let isDraggingVR = false, prevX, prevY;
let isPointerDown = false;
const mouse = new THREE.Vector2();
const ray = new THREE.Raycaster();
const clickables = [];
let fov = 75, minF = 30, maxF = 100;
let controlsTimeout;

vrBtn.onclick = initVR;
exitBtn.onclick = () => { 
    vrGallery.classList.remove('active'); 
    document.exitPointerLock?.(); 
    document.body.style.overflow = '';
};

function initVR() {
    vrGallery.classList.add('active');
    document.body.style.overflow = 'hidden';
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(fov, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 1.6, 5);

    renderer = new THREE.WebGLRenderer({canvas, antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true;

    const ambient = new THREE.AmbientLight(0x404040, 0.8);
    scene.add(ambient);

    const floorTex = new THREE.CanvasTexture(createCheckerboard());
    floorTex.wrapS = floorTex.wrapT = THREE.RepeatWrapping;
    floorTex.repeat.set(20, 20);
    const floor = new THREE.Mesh(
        new THREE.PlaneGeometry(14, 14),
        new THREE.MeshStandardMaterial({map: floorTex, roughness: 0.8})
    );
    floor.rotation.x = -Math.PI/2;
    floor.receiveShadow = true;
    scene.add(floor);

    const ceilingTex = new THREE.CanvasTexture(createCheckerboard());
    ceilingTex.wrapS = ceilingTex.wrapT = THREE.RepeatWrapping;
    ceilingTex.repeat.set(8, 8);
    const ceiling = new THREE.Mesh(
        new THREE.PlaneGeometry(14, 14),
        new THREE.MeshStandardMaterial({color: 0x111111, roughness: 0.9})
    );
    ceiling.rotation.x = Math.PI/2;
    ceiling.position.y = 5.5;
    scene.add(ceiling);

    const wallMat = new THREE.MeshStandardMaterial({color: 0x000000, roughness: 0.9});
    const walls = [
        {pos: [0, 2.75, -7], size: [14, 5.5, 0.3]},
        {pos: [-7, 2.75, 0], size: [0.3, 5.5, 14]},
        {pos: [7, 2.75, 0], size: [0.3, 5.5, 14]}
    ];
    walls.forEach(w => {
        const wall = new THREE.Mesh(new THREE.BoxGeometry(...w.size), wallMat);
        wall.position.set(...w.pos);
        scene.add(wall);
    });

    const radius = 6;
    const maxWidth = 3.5, maxHeight = 3.5;
    const spotLights = [];
    artworkData.forEach((art, i) => {
        const angle = (i / artworkData.length) * Math.PI * 2;
        const x = Math.sin(angle) * radius;
        const z = Math.cos(angle) * radius;
        const g = new THREE.Group();

        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.src = art.file;
        img.onload = () => {
            const aspect = img.width / img.height;
            let planeWidth = maxWidth;
            let planeHeight = maxWidth / aspect;
            if (planeHeight > maxHeight) { planeHeight = maxHeight; planeWidth = maxHeight * aspect; }
            const tex = new THREE.TextureLoader().load(art.file);
            tex.colorSpace = THREE.SRGBColorSpace;
            const plane = new THREE.Mesh(
                new THREE.PlaneGeometry(planeWidth, planeHeight),
                new THREE.MeshStandardMaterial({map: tex, roughness: 0.9})
            );
            plane.position.z = 0.06;
            plane.userData.idx = i;
            g.add(plane);
            clickables.push(plane);

            const frame = new THREE.Mesh(
                new THREE.BoxGeometry(planeWidth + 0.2, planeHeight + 0.2, 0.1),
                new THREE.MeshStandardMaterial({color: 0x000000})
            );
            g.add(frame);

            // INDIVIDUAL SPOTLIGHT ABOVE EACH PAINTING
            const light = new THREE.SpotLight(0xdaa520, 1.5, 10, Math.PI/6, 0.5);
            light.position.set(x, 4.5, z);
            light.target.position.set(x, 2.2, z);
            light.castShadow = true;
            scene.add(light);
            scene.add(light.target);
            spotLights.push(light);
        };

        g.position.set(x, 2.2, z);
        g.lookAt(0, 2.2, 0);
        scene.add(g);
    });

    clock = new THREE.Clock();
    animate();
    setupVREvents();
    canvas.requestPointerLock();
}

/* ===== VR ANIMATION LOOP ===== */
function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();
    vel.x -= vel.x * 12 * delta;
    vel.z -= vel.z * 12 * delta;
    dir.z = Number(moveF) - Number(moveB);
    dir.x = Number(moveR) - Number(moveL);
    dir.normalize();
    if (moveF || moveB) vel.z -= dir.z * 18 * delta;
    if (moveL || moveR) vel.x -= dir.x * 18 * delta;
    camera.translateX(vel.x * delta);
    camera.translateZ(vel.z * delta);
    const max = 6.5;
    camera.position.x = Math.max(-max, Math.min(max, camera.position.x));
    camera.position.z = Math.max(-max, Math.min(max, camera.position.z));

    if (isPointerDown) {
        ray.setFromCamera(mouse, camera);
        const hits = ray.intersectObjects(clickables);
        if (hits.length) {
            const idx = hits[0].object.userData.idx;
            vrGallery.classList.remove('active');
            openLightbox(idx);
            document.exitPointerLock();
        }
        isPointerDown = false;
    }
    renderer.render(scene, camera);
}

/* ===== VR CONTROLS ===== */
function setupVREvents() {
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    document.addEventListener('keydown', e => {
        if (['KeyW','ArrowUp'].includes(e.code)) moveF = true;
        else if (['KeyS','ArrowDown'].includes(e.code)) moveB = true;
        else if (['KeyA','ArrowLeft'].includes(e.code)) moveL = true;
        else if (['KeyD','ArrowRight'].includes(e.code)) moveR = true;
        showControls();
    });
    document.addEventListener('keyup', e => {
        if (['KeyW','ArrowUp'].includes(e.code)) moveF = false;
        else if (['KeyS','ArrowDown'].includes(e.code)) moveB = false;
        else if (['KeyA','ArrowLeft'].includes(e.code)) moveL = false;
        else if (['KeyD','ArrowRight'].includes(e.code)) moveR = false;
    });

    canvas.addEventListener('pointerdown', e => {
        isDraggingVR = true;
        prevX = e.clientX; prevY = e.clientY;
        showControls();
    });
    canvas.addEventListener('pointermove', e => {
        if (!isDraggingVR) return;
        const dx = e.clientX - prevX, dy = e.clientY - prevY;
        camera.rotation.y -= dx * 0.002;
        camera.rotation.x -= dy * 0.002;
        camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
        prevX = e.clientX; prevY = e.clientY;
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    });
    canvas.addEventListener('pointerup', e => {
        isDraggingVR = false;
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        isPointerDown = true;
    });

    let touchDragging = false, touchStartXVR = 0, touchStartYVR = 0;
    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        const t = e.touches[0];
        touchDragging = false;
        touchStartXVR = t.clientX; touchStartYVR = t.clientY;
        prevX = t.clientX; prevY = t.clientY;
        showControls();
    });
    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        const t = e.touches[0];
        const dx = t.clientX - prevX, dy = t.clientY - prevY;
        if (Math.abs(t.clientX - touchStartXVR) > 5 || Math.abs(t.clientY - touchStartYVR) > 5) touchDragging = true;
        camera.rotation.y -= dx * 0.002;
        camera.rotation.x -= dy * 0.002;
        camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
        prevX = t.clientX; prevY = t.clientY;
    });
    canvas.addEventListener('touchend', e => {
        if (!touchDragging && e.changedTouches.length) {
            const t = e.changedTouches[0];
            mouse.x = (t.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(t.clientY / window.innerHeight) * 2 + 1;
            isPointerDown = true;
        }
    });

    canvas.addEventListener('wheel', e => {
        e.preventDefault();
        fov = Math.max(minF, Math.min(maxF, fov + e.deltaY * 0.05));
        camera.fov = fov;
        camera.updateProjectionMatrix();
        showControls();
    });
}

function showControls() {
    const info = document.getElementById('controlsInfo');
    info.classList.add('show');
    clearTimeout(controlsTimeout);
    controlsTimeout = setTimeout(() => info.classList.remove('show'), 3000);
}
function zoomIn() { fov = Math.max(minF, fov - 10); camera.fov = fov; camera.updateProjectionMatrix(); }
function zoomOut() { fov = Math.min(maxF, fov + 10); camera.fov = fov; camera.updateProjectionMatrix(); }
function resetZoom() { fov = 75; camera.fov = fov; camera.updateProjectionMatrix(); }

/* ===== ETHEREAL BACKGROUND SOUND ===== */
const audio = document.getElementById('bgAudio');
const btn = document.getElementById('muteToggle');
let playing = false;

btn.addEventListener('click', () => {
    if (playing) {
        audio.pause();
        btn.textContent = 'Play';
    } else {
        audio.play().catch(() => {});
        btn.textContent = 'Pause';
    }
    playing = !playing;
});

document.addEventListener('click', () => {
    if (!playing) {
        audio.volume = 0.25;
        audio.play().catch(() => {});
        playing = true;
        btn.textContent = 'Pause';
    }
}, { once: true });

/* ===== HELPER: CHECKERBOARD TEXTURE ===== */
function createCheckerboard() {
    const canvas = document.createElement('canvas');
    canvas.width = 128; canvas.height = 128;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f0f0f0'; ctx.fillRect(0,0,128,128);
    ctx.fillStyle = '#e0e0e0'; ctx.fillRect(0,0,64,64); ctx.fillRect(64,64,64,64);
    ctx.fillStyle = '#f8f8f8'; ctx.fillRect(32,32,32,32); ctx.fillRect(96,96,32,32);
    return canvas;
}
</script>
</body>
</html>